<head>
    <title>Ficha {{sheet.name}}</title>
    <b>Logado como: {{session.name}}</b>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    {{!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> --}}
    <style>
        {box-sizing: border-box;}

        /* Button used to open the contact form - fixed at the bottom of the page */
        .open-button {
            background-color: #555;
            color: white;
            padding: 16px 20px;
            border: none;
            cursor: pointer;
            opacity: 0.8;
            position: fixed;
        }

        /* The popup form - hidden by default */
        .form-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);S
            margin: auto;
            border: 3px solid #f1f1f1;
            z-index: 9;
        }

        /* Add styles to the form container */
        .form-container {
            max-width: 500px;
            padding: 10px;
            background-color: white;
        }

        /* Full-width input fields */
        .form-container input[type=text], .form-container input[type=password] {
            width: 100%;
            padding: 5px;
            margin: 5px 0 10px 0;
            border: none;
            background: #f1f1f1;
        }

        /* When the inputs get focus, do something */
        .form-container input[type=text]:focus, .form-container input[type=password]:focus {
            background-color: #ddd;
            outline: none;
        }

        /* Set a style for the submit/login button */
        .form-container .btn {
            background-color: #04AA6D;
            color: white;
            padding: 16px 20px;
            border: none;
            cursor: pointer;
            width: 100%;
            margin-bottom:10px;
            opacity: 0.8;
        }

        /* Add a red background color to the cancel button */
        .form-container .cancel {
            background-color: red;
        }

        /* Add some hover effects to buttons */
        .form-container .btn:hover, .open-button:hover {
            opacity: 1;
        }

        .column {
           float: left;
            width: 33.33%;
        }
    </style>
    <style>
        @media {
            .container-fluid {
                margin-left: 1%;
                margin-right: 1%;
            }
        }
        .containter-fluid {
            margin-left: 25px;
        }
        input[type='number'] {
            width: 50%;
        }
    </style>
</head>
<body>
    <h3>Ficha:&nbsp;{{sheet.name}}</h3>
    <input type="text" id="sheetId" value="{{sheet.id}}" hidden></p>
    <hr class="border border-primary border-3 opacity-75">
    <div class="container-fluid">
        <div class="row">
            {{!-- Status --}}
            <div class="col-4">
                {{!-- Pontos de Vida e Pontos de Mana --}}
                <div class="row">
                    <div id="result" class="col-4">
                        <b>Pontos de Vida</b><br>
                        <input id="hp-value" type="number" name="hp" value="0">
                        <button id="calc-hp">Calcular</button>
                        <div class="hp"></div>
                        <script>
                            $(document).ready(() => {
                                loadHP()
                            })
                            function loadHP() {
                                $.ajax({
                                    type: "POST",
                                    dataType: "JSON",
                                    url: "/loadHP",
                                    data: {id: '{{sheet.id}}'},
                                    success: (data) => {
                                        var html = ''

                                        html = '<div>'+ data.data.current_hp +' / '+ data.data.max_hp +'</div>'

                                        $('div.hp').html(html)
                                    }
                                })
                            }

                            function editHP(value) {
                                $.ajax({
                                    type: 'PUT',
                                    dataType: 'JSON',
                                    url: '/editHP',
                                    data: {id: '{{sheet.id}}', value: value},
                                    success: (data) => {
                                        console.log(data.data)
                                        loadHP()
                                    }
                                })
                            }

                            $("#calc-hp").click(() => {
                                editHP($("#hp-value").val())
                                document.getElementById('hp-value').value = '0'
                            })

                        </script>
                    </div>
                    <div id="result" class="col-4">
                        <b>Pontos de Mana</b><br>
                        <input id="mp-value" type="number" name="mp" placeholder="0">
                        <button id="calc-mp">Calcular</button>
                        <div class="mp"></div>
                        <script>
                            $(document).ready(function () {
                                loadMP()
                            })
                            function loadMP() {
                                $.ajax({
                                    type: "POST",
                                    dataType: "JSON",
                                    url: "/loadMP",
                                    data: {id: '{{sheet.id}}'},
                                    success: function (data) {
                                        var html = ''

                                        html = '<div>'+ data.data.current_mp +' / '+ data.data.max_mp +'</div>'

                                        $('div.mp').html(html)
                                    }
                                })
                            }

                            function editMP(value) {
                                $.ajax({
                                    type: 'PUT',
                                    dataType: 'JSON',
                                    url: '/editMP',
                                    data: {id: '{{sheet.id}}', value: value},
                                    success: (data) => {
                                        console.log(data.data)
                                        loadMP()
                                    }
                                })
                            }

                            $("#calc-mp").click(() => {
                                editMP($("#mp-value").val())
                                document.getElementById("mp-value").value = '0'
                            })
                        </script>
                    </div>
                </div>
                {{!-- Tamanho e Alcance --}}
                <div class="row">
                    <div class="col-4">
                        <b>Tamanho</b><br>
                        <div>{{status.size}}</div>
                    </div>
                    <div class="col-4">
                        <b>Alcance</b>
                        <div>{{status.reach}}</div>
                    </div>
                </div>
                <b>Velocidades</b>
                <div class="row">
                    <div class="col-4">
                        <div>Em Terra:&nbsp;{{status.land_speed}}</div>
                        <div>Escalada:&nbsp;{{status.climb_speed}}</div>
                    </div>
                    <div class="col-4">
                        <div>Natação:&nbsp;{{status.swim_speed}}</div>
                        <div>Voo:&nbsp;{{status.fly_speed}}</div>
                    </div>
                </div>
                {{!-- CD de Classe, Sobrecarga e Percepção --}}
                <div class="row">
                    <div class="col-4">
                        <b>CD de Classe</b>
                        <div>{{status.class_cd}}</div>
                    </div>
                    <div class="col-4">
                        <b>Sobrecarga</b>
                        <div>{{status.overload}}</div>
                    </div>
                    <div class="col-4">
                        <b>Percepção</b>
                        <div>{{status.perception}}</div>
                    </div>
                </div>
                {{!-- Defesa --}}
                <div class="row">
                    <div class="col-4">
                        <b>Defesa</b>
                        <div>{{status.defense}}</div>
                    </div>
                    <div class="col-4">
                        <b>Bônus de Defesa</b>
                        <div>{{status.defense_bonus}}</div>
                    </div>
                </div>
                {{!-- Atributos --}}
                <div class="row">
                    <div class="col-2">
                        <b>FOR</b>
                        <div>{{status.str}}</div>
                    </div>
                    <div class="col-2">
                        <b>DES</b>
                        <div>{{status.dex}}</div>
                    </div>
                    <div class="col-2">
                        <b>CON</b>
                        <div>{{status.con}}</div>
                    </div>
                    <div class="col-2">
                        <b>INT</b>
                        <div>{{status.int}}</div>
                    </div>
                    <div class="col-2">
                        <b>SAB</b>
                        <div>{{status.wis}}</div>
                    </div>
                    <div class="col-2">
                        <b>CAR</b>
                        <div>{{status.cha}}</div>
                    </div>
                </div>
                {{!-- Salvamentos --}}
                <div class="row">
                    <div class="col-4">
                        <b>Fortitude</b>
                        <div>{{status.fortitude}}</div>
                    </div>
                    <div class="col-4">
                        <b>Reflexos</b>
                        <div>{{status.reflex}}</div>
                    </div>
                    <div class="col-4">
                        <b>Vontade</b>
                        <div>{{status.will}}</div>
                    </div>
                </div>
                <br>
            </div>
            {{!-- Sheet --}}
            <div class="col-4">
                <b>Nome:&nbsp;</b>
                <div>{{sheet.name}}</div>
                <br>
                <b>Clã:&nbsp;</b>
                <div>{{sheet.clan}}</div>
                <br>
                <b>Origem:&nbsp;</b>
                <div>{{sheet.origin}}</div>
                <br>
                <b>Aspecto:&nbsp;</b>
                <div>{{sheet.aspect}}</div>
                <br>
                <b>Classe:&nbsp;</b>
                <div>{{sheet.class}}</div>
                <br>
                <b>Nível:&nbsp;</b>
                <div>{{sheet.level}}</div>
                <br>
                <b>Idiomas:&nbsp;</b>
                <div>{{sheet.language}}</div>
                <br>
                <b>Descrição:&nbsp;</b>
                <div>{{sheet.description}}</div>
                <br>
                <b>Anotações:&nbsp;</b>
                <div>{{sheet.notes}}</div>
                <br>
                <button id="form-sheet" class="open-button" onclick="openForm()">Open Form</button>

                <div id="myForm" class="form-popup">
                    <form id="form-edit" class="form-container" action="/minha-ficha/{{sheet.id}}?_method=PUT" method="POST">
                        <h1>Geral</h1>

                        <label for="name"><b>Nome</b></label>
                        <input type="text" value="{{sheet.name}}" name="name" required disabled>

                        <label for="clan"><b>Clã</b></label>
                        <input type="text" value="{{sheet.clan}}" name="clan" required disabled>

                        <label for="origin"><b>Origem</b></label>
                        <input type="text" value="{{sheet.origin}}" name="origin" required disabled>

                        <label for="aspect"><b>Aspect</b></label><br>
                        <input type="text" value="{{sheet.aspect}}" name="aspect" required disabled>

                        <label for="class"><b>Classe</b></label>
                        <input type="text" value="{{sheet.class}}" name="class" required disabled>

                        <label for="level"><b>Nível</b></label><br>
                        <input type="number" value="{{sheet.level}}" name="level" required disabled>
                        <br>
                        <label for="language"><b>Idiomas</b></label>
                        <input type="text" value="{{sheet.language}}" name="language" required disabled>

                        <label for="description"><b>Descrição</b></label>
                        <input type="text" value="{{sheet.description}}" name="description" disabled>

                        <label for="notes"><b>Anotações</b></label>
                        <input type="text" placeholder="Anotações..." value="{{sheet.notes}}" name="notes" disabled>

                        <button id="save-sheet" type="submit" class="btn" disabled>Salvar</button>
                        <button id="close-sheet" type="button" class="btn cancel" onclick="closeForm()" disabled>Cancelar</button>
                    </form>
                </div>
                <script>
                    function openForm() {
                        document.getElementById("myForm").style.display = "block";
                    }

                    function closeForm() {
                        document.getElementById("myForm").style.display = "none";
                    }

                    var form = document.forms[0],
                    btn1 = document.getElementById('form-sheet'),
                    btn2 = document.getElementById('close-sheet')

                    btn1.addEventListener('click', lockForm)
                    btn2.addEventListener('click', lockForm)

                    function lockForm(){
                        btn1.classList.toggle('on');
                        [].slice.call( form.elements ).forEach(function(item){
                            item.disabled = !item.disabled;
                        });
                    }
                </script>
            </div>
        </div>
    </div>
</body>